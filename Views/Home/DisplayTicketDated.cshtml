@{
	ViewData["Title"] = "Display Ticket";
}


<h2 class="content-heading">@ViewBag.DiplayTitle</h2>

<div class="block">
	<div class="block-header block-header-default">
		<div class="block-title">
			<div class="col-lg-6">

				<form asp-controller="Home" asp-action="DisplayTicketDated" method="post">
					<div class="input-daterange input-group" data-date-format="mm/dd/yyyy" data-week-start="1" data-autoclose="true" data-today-highlight="true">
						<input type="text" class="form-control" id="dt1" name="dt1" placeholder="Start Date" data-week-start="1" data-autoclose="true" data-today-highlight="true" autocomplete="off">
						<div class="input-group-prepend input-group-append">
							<span class="input-group-text font-w600">to</span>
						</div>
						<input type="text" class="form-control" id="dt2" name="dt2" placeholder="End Date" data-week-start="1" data-autoclose="true" data-today-highlight="true" autocomplete="off">
						<div class="input-group-append">
							<button class="btn btn-success" type="submit" data-toggle="tooltip" title="Search by Date"><i class="fa fa-search"></i></button>
						</div>
					</div>
				</form>

			</div>
		</div>

		<div class="block-options">

			<a asp-controller="Home" asp-action="Index" class="btn-block-option" data-toggle="tooltip" title="Back to Dashboard">
				<i class="si si-cup"></i>
			</a>
			<input type="text" id="myInput" hidden>
			<a id="btn" href="#" class="btn-block-option" data-toggle="tooltip" title="Export to Excel">
				<i class="fa fa-file-excel-o"></i>
			</a>

		</div>
	</div>

	<div class="block-content block-content-full">
		<!-- Orders Table -->
		<table id="ListServiceTickets" class="table table-bordered table-striped table-vcenter js-service-dataTable">
			<thead>
				<tr>
					<th class="d-none d-sm-table-cell" style="width: 200px;">Ticket No</th>
					<th class="d-none d-sm-table-cell">Customer Name</th>
					<th class="d-none d-sm-table-cell">Last Update</th>
					<th class="d-none d-sm-table-cell">Status</th>
					<th class="d-none d-sm-table-cell">Due Date</th>
					<th class="d-none d-sm-table-cell text-right">Elapsed</th>
					<th class="d-none d-sm-table-cell">Agent</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var usr in ViewBag.DisplayTickets)
				{
					<tr>
						<td class="d-none d-sm-table-cell">
							@if (ViewBag.Dept == "M")
							{
								<a asp-controller="Activity" asp-action="UpdateCMEntry" asp-route-id=@usr.RID data-toggle="tooltip" title="Update this Ticket?">
									@usr.TicketNo
								</a>
							}
							else
							{
								<a asp-controller="Activity" asp-action="ATMEntry" asp-route-id=@usr.RID data-toggle="tooltip" title="Update this Ticket?">
									@usr.TicketNo
								</a>
							}
						</td>

						<td class="d-none d-sm-table-cell">
							@usr.CustomerName
						</td>

						<td class="d-none d-sm-table-cell text-primary" data-sort="YYYYMMDD">
							@usr.DateReceived.ToString("dd-MMM-yyyy")
						</td>
						<td class="d-none d-sm-table-cell">
							@usr.Status
						</td>
						<td class="d-none d-sm-table-cell text-danger" data-sort="YYYYMMDD">
							@usr.resolved.ToString("dd-MMM-yyyy")
						</td>
						<td class="d-none d-sm-table-cell text-right">
							@usr.elapsed
						</td>
						<td class="d-none d-sm-table-cell">
							@usr.agent
						</td>

					</tr>
				}
			</tbody>
		</table>
		<!-- END Orders Table -->

	</div>
</div>

@section Scripts {

	<script>

        $(document).ready(function () {

            $('#modal-container').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget); // Button that triggered the modal
                var url = button.attr("href");
                var modal = $(this);
                // note that this will replace the content of modal-content everytime the modal is opened
                modal.find('.modal-content').load(url);
            });

            $('#modal-container').on('hidden.bs.modal', function () {
                // remove the bs.modal data attribute from it
                $(this).removeData('bs.modal');
                // and empty the modal-content element
                $('#modal-container .modal-content').empty();

            });

        });

		$('#ListServiceTickets').on('search.dt', function () {
			var value = $('.dataTables_filter input').val();
			document.getElementById("myInput").value = value; // <-- the value
		});

		$(function () {
			$('#btn').click(function (evt) {
				$.ajax({
					type: 'GET',
					url:'@Url.Action("GetSearch", "Admin")',
					cache: false,
					data: { myInput: $("#myInput").val() },
					success: function (data) {
						if (data.success) {
							window.location = "/Home/ExportTickets";
						}
					}
				});
			});
		});

		function DeleteUser(url) {
			Swal.fire({
				title: 'Are you sure?',
				text: 'Once deleted, you will not be able to recover this user!',
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Yes, delete it!'
			}).then((result) => {
				if (result.isConfirmed) {
					$.ajax({
						type: 'GET',
						url: url,
						cache: false,
						success: function (data) {
							if (data.success) {
								Swal.fire({
									text: data.message,
									icon: 'success'
								}).then((result) => {
									location.reload();
								});


							}
							else {
								Swal.fire(
									'Error!',
									'Server is busy, please try again later.',
									'error'
								);

							}
						}
					});
				}
			})
		}
	</script>

}