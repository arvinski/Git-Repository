@using AgentDesktop.Models
@using AgentDesktop.Controllers

@{
	ViewData["Title"] = "User Entry";

}

<!-- Dynamic Table Full -->
<div class="block block-themed block-rounded">
    <div class="block-header bg-gray-light">
        <h3 class="block-title text-black-50">LIST OF USERS</h3>
        <div class="block-options">
			<span data-toggle="tooltip" data-placement="top" title="New User">
				<a class="btn btn-alt-primary mr-5" asp-controller="Admin" asp-action="NewUser" data-target="#modal-container" data-toggle="modal" data-backdrop="static" data-keyboard="false">
					<font style="vertical-align: inherit;">
						<font style="vertical-align: inherit;"><i class="fa fa-plus mr-5"></i> New User</font>
					</font>
				</a>
			</span>

            <input type="text" id="myInput" hidden>

			<a id="btn" href="#" class="btn btn-alt-success mr-5" data-toggle="tooltip" title="Export to Excel">
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;"><i class="fa fa-file-excel-o"></i> Export</font>
				</font>
			</a>

            @*<button type="button" class="btn-block-option">
                <i class="si si-wrench"></i>
            </button>*@
            
        </div>
    </div>
	<div class="block-content block-content-full">
		<!-- DataTables functionality is initialized with .js-usr-dataTable class in js/InitDataTables.js -->
		<table id="ListUser" class="table-sm table-bordered table-hover table-vcenter js-usr-dataTable" style="width:100%;">
			<thead class="bg-primary-light">
				<tr>
					<th class="d-none d-sm-table-cell font-size-xs">USER ID</th>
					<th class="d-none d-sm-table-cell font-size-xs">USER NAME</th>
					<th class="d-none d-sm-table-cell font-size-xs">GROUP</th>
					<th class="d-none d-sm-table-cell font-size-xs">DEPARTMENT</th>
					<th class="d-none d-sm-table-cell font-size-xs">EMAIL</th>
					<th class="d-none d-sm-table-cell font-size-xs">STATUS</th>
					<th class="d-none d-sm-table-cell font-size-xs">EXPIRY DATE</th>
					<th class="d-none d-sm-table-cell font-size-xs text-center" style="width: 100px;">OPTION</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var usr in ViewBag.ListUser)
				{
					<tr>

						<td class="d-none d-sm-table-cell font-size-xs" style="white-space:nowrap">@usr.loginid</td>
						<td class="d-none d-sm-table-cell font-size-xs" style="white-space:nowrap">@usr.fullname</td>
						<td class="d-none d-sm-table-cell font-size-xs" style="white-space:nowrap">@usr.group</td>
						<td class="d-none d-sm-table-cell font-size-xs" style="white-space:nowrap">@usr.department</td>
						<td class="d-none d-sm-table-cell font-size-xs" style="white-space:nowrap">@usr.email</td>
						<td class="d-none d-sm-table-cell font-size-xs" style="white-space:nowrap">@usr.stat</td>
						<td class="d-none d-sm-table-cell font-size-xs" style="white-space:nowrap">@usr.expirydate</td>
						<td style="text-align:center;">
							<div class="btn-group">
								<span data-toggle="tooltip" data-placement="top" title="Edit User">
									<a class="btn btn-sm btn-secondary" asp-controller="Admin" asp-action="EditUser" asp-route-id=@usr.id data-target="#modal-container" data-toggle="modal" data-backdrop="static" data-keyboard="false"><span><i class="fa fa-pencil"></i></span></a>
								</span>
								<a class="btn btn-sm btn-secondary" asp-controller="Admin" asp-action="UserRights" asp-route-id=@usr.id data-toggle="tooltip" data-placement="top" title="User Rights" ><span><i class="fa fa-user-plus"></i></span></a>
								<a href="#" class="btn btn-sm btn-secondary" data-toggle="tooltip" title="Delete User" onclick=DeleteUser("/Admin/DelUser/@usr.id");><span><i class="fa fa-times"></i></span></a>
							</div>
						</td>

					</tr>
				}

			</tbody>
		</table>
	</div>
</div>
<!-- END Dynamic Table Full -->

<div class="modal fade" id="modal-container" tabindex="-1" role="dialog" aria-labelledby="modal-container" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-dialog-popout modal-lg" role="document">
		<div class="modal-content">

		</div>
	</div>
</div>

@section Scripts {

	<script>

        $(document).ready(function () {

            $('#modal-container').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget); // Button that triggered the modal
                var url = button.attr("href");
                var modal = $(this);
                // note that this will replace the content of modal-content everytime the modal is opened
                modal.find('.modal-content').load(url);
            });

            $('#modal-container').on('hidden.bs.modal', function () {
                // remove the bs.modal data attribute from it
                $(this).removeData('bs.modal');
                // and empty the modal-content element
                $('#modal-container .modal-content').empty();

            });

        });

		$('#ListUser').on('search.dt', function () {
			var value = $('.dataTables_filter input').val();
			document.getElementById("myInput").value = value; // <-- the value
		});

		$(function () {
			$('#btn').click(function (evt) {
				$.ajax({
					type: 'GET',
					url:'@Url.Action("GetSearch", "Admin")',
					cache: false,
					data: { myInput: $("#myInput").val() },
					success: function (data) {
						if (data.success) {
							window.location = "/Admin/ExportUsers";
						}
					}
				});
			});
		});

		function DeleteUser(url) {
			Swal.fire({
				title: 'Are you sure?',
				text: 'Once deleted, you will not be able to recover this user!',
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Yes, delete it!'
			}).then((result) => {
				if (result.isConfirmed) {
					$.ajax({
						type: 'GET',
						url: url,
						cache: false,
						success: function (data) {
							if (data.success) {
								Swal.fire({
									text: data.message,
									icon: 'success'
								}).then((result) => {
									location.reload();
								});


							}
							else {
								Swal.fire(
									'Error!',
									'Server is busy, please try again later.',
									'error'
								);

							}
						}
					});
				}
			})
		}
	</script>

}